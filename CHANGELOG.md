# Changelog

主なもののみ

## v1.0.0 (2017-10-6)
- 初版


## v1.1.0 (2017-10-11)
- NGを適用するコメント元が保存されるようになった
- NGを適用するコメント元を複数指定できるようになった
    - 今までのNG設定は消えます
- コメントログの自動スクロールの仕方を変えた
- コメントログのコメントの内容とユーザーをクリップボードにコピーできるようになった
- コメントログのコラムの幅を保存するようになった
    - コラムの順序はまだ保存しません
- コメントログのコメントをダブルクリックでコメント詳細ウィンドウを開くようにした
- 2chのコメント色を設定できるようにした
- コメント投稿をEnter、改行をAlt+Enterに変えた


## v1.2.0 (2017-10-22)
- メインウィンドウの大きさが保存されないのを直した
- 任意のコメント元のコメントをランダム色にできるようになった
    - NG設定から設定します
        - 逆に2ch設定でランダム色にはできなくなった
- ログに表示するコメント数を設定できるようになった
- コメントの表示時刻調整ができるようになった
- 4時リセット対策をした、がテストはしてない


## v1.3.0 (2017-11-5)
- コメントファイルからコメントを読み込めるようになった
- ニコニコ実況で複数行コメントが空白になるのを直した
- ログのコラムの順序が保存されるようになった
- 2chコメント元設定でスレをダブルクリックでも決定できるように直した
- 2chコメント元設定でスレ更新ボタンをつけた
- 複数行コメントをsmallにできるようになった
    - NG設定から設定します
- コメント番号を表示するようにした

## v1.4.0 (2020-12-15)
- .NET Core 3.1に移行
- 5chAPIからレスを取得し表示できるように
- channels.txt等の設定ファイルがないと無言で終了するのを修正
- 5chの自動スレ選択でネットワークIDが不明でもほとんどの場合機能するように
- 5chのレスが団子にならないように遅延して表示するように
- 5chの投稿機能の代わりにスレをブラウザで開けるように
- ニコニコ生放送のコメント表示投稿機能追加
- ニコニコ実況の勢い値の取得をやめる
- コメントログ数を0に設定することで古いコメントの削除を行わないように

## v1.5.0 (2020-12-17)
- ニコニコ生放送で生放送IDをch*********等のエイリアスでも指定できるように
- ニコニコと5chの設定を適用したときに設定値が不正だと入力が元に戻るのを修正
- 複数の種類のコメント元設定ダイアログを使うと落ちたり挙動がおかしくなったりするのを修正
- 設定関係の処理を刷新し、設定ファイルをjsonに変更、保存場所もexeファイルと同フォルダにする
    - 前バージョンの設定はリセットされます

## v1.6.0 (2020-12-18)
- メインウィンドウにタイトルバーもどきを表示および4辺の端でもリサイズできるように
- 2020/12/16からの新ニコニコ実況に対応
- 旧ニコニコ実況と2chHTML関係のUIへの表示をやめる

## v1.6.1 (2020-12-19)
- メインウィンドウのフォントサイズを変更できるように
- メインウィンドウの「設定」タブの次回起動時保存されるべき設定の一部が保存されないのを修正

## v1.6.2 (2020-12-19)
- 「コメント元」タブの「追加↓」「削除↑」ボタンの有効無効状態がおかしくなるのを修正

## 本家からFork

## v1.6.3 (2020-12-20) 
- 非公式過去ログAPIから過去ログを取得する機能を追加
- 自動選択設定の録画時の読み込み時がバグるのを修正

## v1.6.4 (2020-12-21) 
- 最初に過去ログ取得したタイミングより前にシークすると過去ログを取得できなくなるのを修正
- TvTComment本体の設定ファイル読み込みに関するバグを修正。

## v1.6.5 (2020-12-21)
### 本家v1.6.3 (2020-12-21)変更分のマージ
- json設定にて自動選択の録画のほうの設定が視聴時のほうに読み込まれる bugfix
    - noriokun4649 さんありがとうございます
- 前回終了時のメインウィンドウのタブ選択を起動時に復元するように
- メインウィンドウの外周に黒の境界線を追加
- メインウィンドウを初期化が終わるまで最小化しておく
- コメント元自動選択を有効にした時もとから同じコメント元があると二重になるのを修正
- コメント元自動選択をリアルタイム、録画を変えないまま有効→無効→有効とすると働かないのを修正

## v1.6.6 (2020-12-21)
- 非公式過去ログAPIのエラー処理を追加

## v1.6.7 (2020-12-23)
- 新ニコニコ実況の過去ログのスレッドID数字じゃない問題に対応
- 取得仕様とする過去ログの終了時間が現在時刻以降の場合現時刻までにするように変更

## v1.6.8 (2020-12-24)
- 非公式過去ログAPIから過去ログを取得する感覚を1時間から10分へ変更。  
    - 1時間取得だとコメントの多い番組の場合フリーズするらしいので、一応金曜ロードSHOW!のサマーウォーズで検証した結果10分で大丈夫そう。
- 前回の取得時刻と再生時刻からの差分を計算する箇所のミスを修正。
    - 計算結果612秒の場合612にならなきゃいけないのだが、10分12秒なので結果は12になるという糞処理してた。

## v1.6.9 (2020-12-25)
- 10分ごとに過去ログ取得するタイミングで数分コメントが重複するのを修正

## v1.6.10 (2020-12-25)
- 過去ログにdate_usecレコードが必ず入っていると仮定しない。
    - 2017年8月頃より前の過去ログで正常に再生できなかった原因はこれ。

## v1.6.11 (2020-12-27)
- タイムアウト処理の追加
- 設定の追加。settings.jsonのNiconicoブロック内に下記の設定が追加されました。
    ```json
    "UnOfficialNiconicoLog": {
        "UnOfficialApiTimeOut": 30,
        "UnOfficialApiGetInterval": 1,
        "UnOfficialApiUri": "https://jikkyo.tsukumijima.net/api/kakolog/jk{jkId}?starttime={start}\u0026endtime={end}\u0026format=xml"
    }
    ```
    | 項目 | 内容・説明  |
    | ------------ | ------------ |
    | UnOfficialApiTimeOut  |  タイムアウトを設定します。デフォルト:30 単位:秒 |
    | UnOfficialApiGetInterval | 過去ログ取得のインターバルを設定します。 デフォルト:1 単位:10分 |
    | UnOfficialApiUri  |  過去ログ取得APIのURIを設定します。 {jkId}は実況ID、{start}は開始のUnixtime、{end}は終了のUnixtimeに置き換えられてます。 |
- User-Agentの設定。

## v1.6.12 (2020-12-28)
- 勢い実装　ソースコード汚い......

## v1.6.13 (2020-12-28)
- 過去ログ反映前に取得しに行くと毎秒取得し続けるのを修正
    - 非公式過去ログAPIさん申し訳ありませんでした。

## v1.6.14 (2020-12-29)
- 勢い取得の実装をリファクタリング
- IME変換時の不具合を回避するように
    - どうやらIMEによっては変換時にUpdateSourceTrigger=PropertyChangedが反応してしまってバグるらしい。ATOK、Microsoft IMEで回避を確認。

## v1.6.15 (2020-12-31)
- 本家v1.7.0と1.8.0分をマージ
- 本家さんの方も非公式過去ログAPIに対応した為、本バージョンをもってReleaseの更新を停止します。リポジトリは更新するかも。
    - 現時点での本家との違いは勢い表示の有無だけになります。非公式過去ログAPI対応は本家の方を有効にしています。

> ### v1.7.0 (2020-12-29)
> - .NET 5 に移行
> - 5chの過去ログからレスを取得し表示するコメント元を追加
> - コメントの色を変えるChatModRuleを追加
> - 2chのコメント元のコメント色設定機能を削除
> - 5chAPIで使用するユーザーエージェント等についての設定を設定ファイルに追加しさらにUIで編集できるように
> 
> ### v1.8.0 (2020-12-30)
> - [tsukumijimaさんが提供している非公式ニコニコ実況過去ログAPI](https://jikkyo.tsukumijima.net/)からコメントを表示する機能を追加
> - 以下2つは [noriokun4649](https://github.com/noriokun4649) さんご提供です。ありがとうございます。
>     - IMEの変換中にEnterで確定せずに入力すると消える不具合を回避するように
>     - 新ニコニコ実況でログインチェック無かったのを修正

## v1.6.16.1 (2021-01-17)
- 本家v1.8.1分をマージ
- Twitterリアルタイム実況機能を追加実装。
- プリリリース、つまりテスト版

> ## v1.8.1 (2021-01-13)
> - UIで設定できるメインウィンドウフォントサイズの最大値を上げる
> - アンカー表記削除などのコメント改変ルールの実装
>     - [Nep](https://github.com/SlashNephy) さんありがとうございます
> - 配布ZIPファイルのniconicoliveids.txtにＡＴ－Ｘの設定を追加
>     - [yt4687](https://github.com/yt4687) さんありがとうございます

## v1.6.16.2 (2021-01-20)
- 本家v1.9.0分をマージ
- Twitterリアルタイム実況の時刻が協定世界時なのを修正
- Twitter投稿機能を実装
    - コマンド入力部分にハッシュタグなどを入力しておくと、ツイートの最後にハッシュタグを加えてツイートできます
- 検索ワード入力画面の自動・手動を実装
    - 検索ワードの自動選択を実装しました。同梱している「twittersearchword.txt」で定義された検索ワードを自動で設定します
- プリリリース、つまりテスト版

> ## v1.9.0 (2021-01-17)
> - 2chの設定のデフォルト値がレス更新間隔と収集スレッド更新間隔で入れ替わっていたのを修正
> - スライダーのドラッグがしづらいことが多いのでUIで設定できるメインウィンドウフォントサイズの最大値を下げる
> - メインウィンドウのタイトルバーにプラグイン無効化とウィンドウ最小化のボタンを追加
> - 2ch過去ログでスレタイキーワードを考慮に入れたスレ選択を行う

## v1.6.16.3 (2021-01-21)
- getplayerstatus廃止につき別APIへ変更

## v1.6.16.4 (2021-01-22)
- コメント元自動選択へTwitterリアルタイム実況を追加 #3
- コメント投稿処理における脱getplayerstatus #4
- ニコ生放送ID設定txtに放送IDが重複して登録されてた場合に勢いの計算がおかしくなるのを修正 #6
- 新ニコニコ実況にて放送してない時にスローする例外を変更

## v1.6.16.5 (2021-01-31)
- ハッシュタグ改変に関するバグ修正 #1
- 指定文字数以上をNGにする設定を追加
- 本家v1.10.1分をマージ

> ## v1.10.1 (2021-01-26)
> - 2chのdatのフィールドが通常5つのところ6つになっているバグデータでも解析できるように

## v1.6.17 (2021-02-15)
- コメント受信をWebSocketへ移行 #5
    - 3月25日前後にXMLSocketが廃止される予定のためそれ以降も利用できるようWebSocketへ移行
- /disconnectメッセージを受信後に自動で再接続するようにした
    - /disconnectメッセージは枠終了後1分後に送られてくるので、コミュニティ・チャンネルで既に新しい枠があればそっちに接続される
        - なので公式実況の場合4時リセット後の4時1分ぐらいに新しい枠に自動で接続される
- 削除されたコメがあると不正な応答で過去ログ取得できないのを修正

## v1.6.18 (2021-06-23)
- 本家v1.10.2分をマージ
- 本家v1.10.3分をマージ
- エラーで再接続が必要な時に負荷を掛けにくくするように変更
- Annict設定のUIを追加 
    - なおこのUIはUIのみの実装であり機能面は実装されていません。  
    途中からブランチをわけたので開発中の内容は [add_annict_util](https://github.com/noriokun4649/TVTComment/commits/add_annict_util) にあります
- 以下の機能追加・修正を適用　これらは [Nep](https://github.com/SlashNephy) さん提供ですありがとうございます。
    - コメント元が自動選択の際にエラーが発生した場合、自動でコメント元を再追加する #12
    - 任意の正規表現によるコメント改変 / NG ルールの実装 #13
    - ツイートの言語を日本語に限定 #15
    - 可能な場合はツイートの本文を省略されないように #16
    - ハッシュタグの正規表現を修正 #17
    - twittersearchword.txt で検索ワードを複数個指定できるように #18
    - 2chthreads.txt でチャンネルの板定義を複数設定できるように #19
    - 2ch スレッドキーワードがない場合に任意のスレッドを選択するように #20
    - 各種.txtファイルを更新 [SlashNephy/TVTComment-txt](https://github.com/SlashNephy/TVTComment-txt) 

> ## v1.10.2 (2021-02-21)
> - 以下2つは [noriokun4649](https://github.com/noriokun4649) さんご提供です。ありがとうございます。
>     - 削除されたコメがあると不正な応答で過去ログ取得できないのを修正
>     - 2chDATパーサーにおいて日時に秒がないデータを考慮するように変更
>
> ## v1.10.3 (2021-03-01)
> - 終了時にニコニコのログアウト処理をするように
>     - [a1lic](https://github.com/a1lic) さんのご協力です。ありがとうございます。

## Crash fix (2021-08-14)
- チャンネル切替時などに不特定多数の環境でTvTestがフリーズもしくはTvTCommentが落ちる問題を修正
  - これで安定性は上がったとおもう

## Crash fix 2 (2021-08-15)
- 壊れているデータの判定方法を変更。32bit の環境でもチャンネル切替時などに不特定多数の環境でTvTestがフリーズもしくはTvTCommentが落ちる問題を修正

## v2.0.0 (2021-09-06)
- ニコ生コメント初回取得時に読み込む過去のコメントの数を変更
    - WebSocket化したときに過去150コメ取得するようにしてしまっていたのを10コメに戻した
- TvTComment.exe側のUIがチラつくのを抑えるオプションを追加
    - このオプションを有効にするとUIのタイトルから時間情報が表示されなくなる代わりにUIがチラつかなくなります
- ニコニコ生放送へのコメント投稿機能を追加
    - pre-release版からの変更点は以下の通り
        - コマンドの対応
        - ニコニコのサーバからのエラーメッセージを処理するように
        - CPU使用率が20%近くになっていたのを1～2%程度に抑えた
- Twitterリアルタイム実況にてモード表示が英語だったのを日本語に変更
- Twitter API V2 版を追加
    - Twitter API V2 版を利用するにはTwitter API v2に対応したAPI keyとSecretが必要です。  
    あと、既にログインしている場合はログインしなおす必要があります。(Bearer Tokenが必要なので)
    - メリット
        - 検索ワードの変更にStreamの切断・再接続が必要ない為API制限を受けにくく  
        チャンネル切替や番組が変わったときにAPI制限で切断されることが減る
        - CJKに正式に対応しているAPIなので検索ワードが日本語でも検索出来る
    - デメリット
        - 従来のAPIに比べて3～5秒程度遅延がある
        - CJK対応で引っかかるツイートが増えた影響で、関係の無いメンションや  
        番組サイトのツイートなどが引っかかる(これは下記で追加したNG設定である程度対処可能)
- URL、メンションが含まれるコメのNGを追加
- Annictからハッシュタグを自動取得する機能を追加
    - この機能を使うには設定からAnnictに接続する必要があります
    - 設定後はTwitterリアルタイム実況追加時に「自動(アニメ用・Annictからハッシュタグ取得)」  
    を選択すればAnnictからハッシュタグを取得してきます  
    Annictに情報が無いなどで取得出来なかった場合はプリセットが適用されます
    - 自動選択でTwitterリアルタイム実況を有効時に「自動(アニメ用・Annictからハッシュタグ取得)」を使いたい場合は
    Annictの設定画面下部にあるチェックボックスを有効にしてください
- ユーザーコミュニティの生放送でも勢いを表示するように変更
    - この変更により勢いを表示するにはニコニコへのログインが必須になりました

- 以下の機能追加・修正を適用　これらは [Nep](https://github.com/SlashNephy) さん提供ですありがとうございます。
    - 2ch過去ログの取得処理の高速化 #23

## v2.0.1 (2021-10-03)
- Vposの無い過去ログの読込をスキップするように変更
- 何も実装されていなかったコンテキストメニューを削除

## v2.0.2 (2021-10-20)
- ニコニコのログインに失敗した(Headerからユーザーidとれない)ときに初期化できない問題 #50 を修正

## v2.0.3 (2021-12-30)
- 2chDATにてスレ自動選択時にHTTPエラーが発生するとクラッシュする #53 を修正
- 2ch鯖移動に伴い2chthreads.txtの鯖アドレスを変更

## v2.1.0 (2022-09-13)
- 最前面表示コマンドと、コメント表示・非表示コマンドの追加、サイドパネル用のアイコンの追加
- 以下は [aznhe21](https://github.com/aznhe21) さんご提供です。ありがとうございます。
    - NicoJKをサブモジュール化＆最新化 #59 
        - これに伴い、`commentFontNameEmoji`を用いて絵文字の表示が可能になる等、利便性向上が見込まれます。

## v2.2.0 (2022-09-20)
2chDATが利用出来ないようですが、現在調査中です。
このバージョンでは2chDATに関する修正は行われていません。

- サイドパネルボタンの状態管理にバグがあったのを修正
- 2段階認証を利用したログインに対応 #67 
    - 2段階認証利用時は起動時の自動ログインには非対応になります
    - 2段階認証はアプリを利用した2段階認証のみ対応です(メール非対応)
- 設定UIをわかりやすいようにグループ化 #68 
- 自分が投稿したコメントを黄色い枠で囲うように変更 #70 #73 
    - ニコニコ動画に関しては、184(匿名)で投稿したコメントは黄色い枠で囲われません
    - ファイル・5chに関しては囲う処理は行われません
    - Twitterはログイン中のアカウントの投稿が黄色い枠で囲われます
- ニコニコにコメントを投稿する際に184(匿名)にするかどうかを切り替える設定を追加
    - ログイン画面の下に追加しました
- 以下の機能追加・修正を適用　これらは [Nep](https://github.com/SlashNephy) さん提供ですありがとうございます。
    - dotnet publish でビルドした際に .NET 5.0 ランタイムが含まれてしまうのを修正 #69 

## v2.2.1 (2022-09-29)
2chDATが利用出来ないようですが、現在調査中です。
このバージョンでは2chDATに関する修正は行われていません。

- 自分のコメントを黄色い枠で囲うよう機能を無効化できる設定を追加
    - TvtComment.iniで設定可能 (設定サンプルファイルは [こちら](https://github.com/noriokun4649/TVTComment/blob/master/Viewer/TvtComment.ini))

## v2.2.2 (2022-10-08)
2chDATが利用出来ないようですが、現在調査中です。
このバージョンでは2chDATに関する修正は行われていません。

- 録画済み(録画中含む)TSをTvtPlayで再生すると落ちる問題を修正 #55 
- 2ch過去ログが取得出来無い問題と、クラッシュする問題を修正 #72

## v3.0.0 (2024-06-14)
- 実況避難先のNX-Jikkyo対応 #101
- NicoJKの更新 #100
- Niconicoへログイン出来ない問題の修正 #96
- 5ch過去ログを利用すると522エラーが出るのを修正 #94
- 5ch Dat が取得出来ない場合にクラッシュするのを修正 #92
- 5ch実況でクラシック版を利用するように変更 #91
- 勢いの取得に時間がかかった場合にクラッシュするのを修正 #90
- 自身の投稿を区別出来るように改善 #70
- コメントセッションに接続していない状態で終了するとクラッシュするのを修正 #88
- 勢い取得じの例外処理を修正 #87
- コメント入力欄の分割幅を保存するように変更 #83
- 他の対応APIでもコメント勢いを取得できるように #27

## v3.0.1 (2024-06-15)
必要な前提ソフト
1. Microsoft Visual C++ 再頒布可能パッケージ(2015-2022)
2. .Net6.0

- NG判定のコメントをログ一覧から除外するオプションを追加 #102
